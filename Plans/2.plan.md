<!-- a2e9df98-36dd-4120-89ce-2c4e1e5f5879 075bcc0c-9fd3-498e-8e2f-6a77d42489fe -->
# Developer 2: Frontend & Netlify Deployment Plan - UPDATED

## Overview

Build a React-based frontend that handles natural language queries through chatbot, displays affordable housing results on an interactive 3D map with markers, and shows comprehensive neighborhood data in a dashboard.

## Workflow

1. **User queries chatbot**: "I need 2 bed 1 bath affordable housing" (natural language)
2. **Frontend sends to backend**: POST `/api/chat` with message
3. **Backend processes** (Developer 3):
   - LLM parses query ‚Üí Queries Raindrop/Database
   - Returns: housing with addresses, lat/long, crime stats, etc.
4. **Frontend displays**:
   - LLM text response in chatbot ‚úÖ
   - Housing markers on map (lat/long coordinates) ‚è≥
   - Click marker ‚Üí Show address popup ‚è≥
   - All data in dashboard (housing, crime, 311) ‚è≥

## Current State

- ‚úÖ React app structure with 3D Mapbox map
- ‚úÖ Chatbot component sends messages to backend
- ‚úÖ Dashboard displays data cards
- ‚è≥ Missing: Housing markers on map
- ‚è≥ Missing: Address popup on marker click
- ‚è≥ Missing: Housing data extraction from chat response
- ‚è≥ Missing: Map-dashboard synchronization

## Phase 1: Complete Core Components - UPDATED

### 1.1 Map Component (`frontend/src/components/Map.jsx`) - **3D VERSION WITH HOUSING MARKERS**

- ‚úÖ 3D Mapbox GL JS map with neighborhoods
- ‚úÖ Neighborhood click selection
- ‚è≥ **NEW**: Accept `housingResults` prop (array of housing with lat/long)
- ‚è≥ **NEW**: Create housing marker layer
- ‚è≥ **NEW**: Marker click ‚Üí Show **comprehensive popup** with:
  - **Price** (from backend)
  - **Address** (from backend)
  - **Crime statistics** (from backend)
  - **Neighborhood data** (from backend)
  - Property details (bedrooms, bathrooms, type)
- ‚è≥ **NEW**: Different marker styles by property type
- ‚è≥ **NEW**: Fly map to housing location when selected
- ‚è≥ **NEW**: Popup displays all backend-provided data

**Housing Marker Implementation**:
```javascript
// Accept housing results
const Map3D = ({ onNeighborhoodSelect, housingResults, selectedHousing, onHousingSelect }) => {
  // Create GeoJSON source from housing results
  const housingSource = {
    type: 'FeatureCollection',
    features: housingResults.map(h => ({
      type: 'Feature',
      geometry: { type: 'Point', coordinates: [h.longitude, h.latitude] },
      properties: { address: h.address, bedrooms: h.bedrooms, ... }
    }))
  };
  
  // Marker click handler
  const onMarkerClick = (housing) => {
    onHousingSelect(housing);
    setPopupInfo({ address: housing.address, ... });
  };
}
```

### 1.2 Chatbot Component (`frontend/src/components/Chatbot.jsx`) - **ENHANCED**

- ‚úÖ Message history with user/assistant bubbles
- ‚úÖ Quick-reply chips for neighborhoods
- ‚úÖ Sends natural language to `/api/chat`
- ‚úÖ Displays LLM text response
- ‚è≥ **NEW**: Extract `response.data.data.housing` from backend
- ‚è≥ **NEW**: Call `onHousingResults` callback with extracted data
- ‚è≥ **NEW**: Display "Found X properties" in chat
- ‚è≥ **NEW**: Handle multiple response formats

**Response Extraction**:
```javascript
// In sendMessage function
if (response.data.data && response.data.data.housing) {
  onHousingResults(response.data.data);
}
```

### 1.3 Dashboard Component (`frontend/src/components/Dashboard.jsx`) - **ENHANCED**

- ‚úÖ Display housing cards with address, type, units
- ‚úÖ Show crime statistics section
- ‚úÖ Display 311 service calls
- ‚è≥ **NEW**: Make housing cards clickable
- ‚è≥ **NEW**: Click card ‚Üí Highlight on map + fly to location
- ‚è≥ **NEW**: Show coordinates in housing cards
- ‚è≥ **NEW**: Highlight selected housing property

**Interactive Cards**:
```javascript
<div 
  className="data-card"
  onClick={() => onHousingSelect && onHousingSelect(house)}
>
  <p><strong>Address:</strong> {house.address}</p>
  <p><strong>Bedrooms:</strong> {house.bedrooms}</p>
  <p><strong>Bathrooms:</strong> {house.bathrooms}</p>
  {house.latitude && <p>üìç {house.latitude}, {house.longitude}</p>}
</div>
```

### 1.4 App Layout (`frontend/src/App.jsx`) - **ENHANCED STATE MANAGEMENT**

- ‚úÖ Main layout: Map + Dashboard + Chatbot
- ‚úÖ Neighborhood selection state
- ‚è≥ **NEW**: `housingResults` state (array from chatbot response)
- ‚è≥ **NEW**: `selectedHousing` state (currently selected property)
- ‚è≥ **NEW**: `handleHousingResults` function
- ‚è≥ **NEW**: `handleHousingSelect` function
- ‚è≥ **NEW**: Pass housing data to Map component

**State Management**:
```javascript
const [housingResults, setHousingResults] = useState([]);
const [selectedHousing, setSelectedHousing] = useState(null);

const handleHousingResults = (data) => {
  if (data.housing) {
    setHousingResults(data.housing);
    setDashboardData(data);
  }
};

const handleHousingSelect = (housing) => {
  setSelectedHousing(housing);
  // Fly map to housing location
};
```

## Phase 2: Styling & UX - COMPLETE ‚úÖ

- ‚úÖ All CSS files created
- ‚úÖ Responsive design
- ‚úÖ Loading states
- ‚úÖ Transitions and animations
- ‚è≥ **NEW**: Marker popup styling
- ‚è≥ **NEW**: Selected housing card highlight

## Phase 3: Backend Integration - UPDATED

### 3.1 API Service (`frontend/src/services/api.js`) - **ENHANCED**

- ‚úÖ Base URL configuration
- ‚úÖ `/api/chat` endpoint
- ‚è≥ **NEW**: Response parser helper
- ‚è≥ **NEW**: Handle multiple response formats

**Response Parser**:
```javascript
export const parseChatResponse = (responseData) => {
  return {
    text: responseData.response || responseData.answer || '',
    housing: responseData.data?.housing || responseData.housing || [],
    crime: responseData.data?.crime || {},
    summary: responseData.data?.summary || null
  };
};
```

### 3.2 Component Integration - **ENHANCED WORKFLOW**

**Chatbot ‚Üí Backend ‚Üí Response Flow**:
1. User types: "2 bed 1 bath affordable housing"
2. Chatbot sends: `POST /api/chat { message, context }`
3. Backend returns: `{ response: "...", data: { housing: [...], crime: {...} } }`
4. Chatbot extracts: `response.data.data.housing`
5. Chatbot calls: `onHousingResults(data)`
6. App updates: `setHousingResults(housing)`
7. Map displays: Markers at housing coordinates
8. Dashboard displays: Housing cards

## Phase 4: Netlify Deployment - PARTIAL ‚è≥

- ‚úÖ Build configuration
- ‚úÖ Netlify config updated
- ‚úÖ Environment variables documented
- ‚è≥ Production build test
- ‚è≥ Deploy to Netlify

## Technical Details - UPDATED

### Backend Response Format (Expected)

```json
{
  "response": "I found 5 affordable 2-bedroom, 1-bathroom properties...",
  "data": {
    "housing": [
      {
        "address": "123 Main St, Chicago, IL 60647",
        "latitude": 41.8781,
        "longitude": -87.6298,
        "bedrooms": 2,
        "bathrooms": 1,
        "price": "$800/month",
        "units": 5,
        "property_type": "Apartment",
        "neighborhood": "Logan Square",
        "crime": {
          "total_incidents": 45,
          "safety_score": 7.5,
          "by_type": {...}
        },
        "neighborhood_data": {
          "summary": "Neighborhood description...",
          "safety_level": "moderate"
        }
      }
    ],
    "crime": { "neighborhood": "Logan Square", "total_incidents": 45 },
    "calls_311": [...],
    "summary": { "text": "...", "safety_level": "moderate" }
  }
}
```

### Housing Marker Requirements

- Each housing result MUST have:
  - `latitude` (number)
  - `longitude` (number)
  - `address` (string)
- Optional but recommended:
  - `bedrooms`, `bathrooms`, `price`, `property_type`

### Key Dependencies

- ‚úÖ `mapbox-gl@^3.0.0` - 3D map rendering
- ‚úÖ `react-map-gl@^7.1.7` - React wrapper for Mapbox
- ‚úÖ `axios@^1.6.0` - API calls
- ‚úÖ `recharts@^2.10.0` - Charts (for crime visualization)

## Deliverables Checklist - UPDATED

- [x] Interactive 3D map with neighborhoods ‚úÖ
- [x] Working chatbot with quick-reply buttons ‚úÖ
- [x] Dashboard displaying neighborhood data ‚úÖ
- [x] Responsive design ‚úÖ
- [x] CSS styling for all components ‚úÖ
- [ ] **Housing markers on map** ‚è≥
- [ ] **Address popup on marker click** ‚è≥
- [ ] **Housing data extraction from chat response** ‚è≥
- [ ] **Clickable housing cards ‚Üí Map navigation** ‚è≥
- [ ] Connected to backend API (structure ready, waiting for backend)
- [ ] Production build tested locally ‚è≥
- [ ] Deployed to Netlify (live URL) ‚è≥

## Implementation Priority

### High Priority (Core Workflow)
1. Update Chatbot to extract housing data from response
2. Add housing markers to Map component
3. Update App.jsx state management
4. Make Dashboard cards clickable
5. Add address popup on marker click

### Medium Priority (Enhancements)
- Marker clustering for many results
- Fly map to housing location
- Filter/sort housing options
- Crime chart visualization

### Low Priority (Nice to Have)
- Route directions
- Save favorites
- Share listings

## Branch Status

- ‚úÖ Branch created: `developer-2-frontend`
- ‚úÖ All core components implemented
- ‚è≥ Workflow enhancements pending
- ‚è≥ Ready for integration testing once backend is ready

